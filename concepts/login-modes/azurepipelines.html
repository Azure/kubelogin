<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Azure Pipelines - Azure Kubelogin</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A Kubernetes credential (exec) plugin implementing azure authentication">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../install.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../../quick-start.html"><strong aria-hidden="true">3.</strong> Quick Start</a></li><li class="chapter-item expanded "><a href="../../concepts.html"><strong aria-hidden="true">4.</strong> Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../concepts/exec-plugin.html"><strong aria-hidden="true">4.1.</strong> Exec Plugin</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes.html"><strong aria-hidden="true">4.2.</strong> Login Modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../concepts/login-modes/devicecode.html"><strong aria-hidden="true">4.2.1.</strong> Device Code</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/azurecli.html"><strong aria-hidden="true">4.2.2.</strong> Azure CLI</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/azd.html"><strong aria-hidden="true">4.2.3.</strong> Azure Developer CLI</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/azurepipelines.html" class="active"><strong aria-hidden="true">4.2.4.</strong> Azure Pipelines</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/interactive.html"><strong aria-hidden="true">4.2.5.</strong> Web Browser Interactive</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/sp.html"><strong aria-hidden="true">4.2.6.</strong> Service Principal</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/msi.html"><strong aria-hidden="true">4.2.7.</strong> Managed Service Identity</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/workloadidentity.html"><strong aria-hidden="true">4.2.8.</strong> Workload Identity</a></li><li class="chapter-item expanded "><a href="../../concepts/login-modes/ropc.html"><strong aria-hidden="true">4.2.9.</strong> Resource Owner Password Credential</a></li></ol></li><li class="chapter-item expanded "><a href="../../concepts/aks.html"><strong aria-hidden="true">4.3.</strong> Using kubelogin with AKS</a></li><li class="chapter-item expanded "><a href="../../concepts/azure-arc.html"><strong aria-hidden="true">4.4.</strong> Using kubelogin to get Proof-of-Possession (PoP) tokens for Azure Arc</a></li></ol></li><li class="chapter-item expanded "><a href="../../cli-reference.html"><strong aria-hidden="true">5.</strong> Command-Line Tool</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../cli/convert-kubeconfig.html"><strong aria-hidden="true">5.1.</strong> convert-kubeconfig</a></li><li class="chapter-item expanded "><a href="../../cli/get-token.html"><strong aria-hidden="true">5.2.</strong> get-token</a></li><li class="chapter-item expanded "><a href="../../cli/remove-cache-dir.html"><strong aria-hidden="true">5.3.</strong> remove-cache-dir</a></li></ol></li><li class="chapter-item expanded "><a href="../../topics.html"><strong aria-hidden="true">6.</strong> Topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../topics/environments.html"><strong aria-hidden="true">6.1.</strong> Using in different environments</a></li><li class="chapter-item expanded "><a href="../../topics/sp.html"><strong aria-hidden="true">6.2.</strong> Using Service Principal</a></li><li class="chapter-item expanded "><a href="../../topics/k8s-oidc-aad.html"><strong aria-hidden="true">6.3.</strong> Setup k8s OIDC Provider using Azure AD</a></li><li class="chapter-item expanded "><a href="../../topics/jenkins.html"><strong aria-hidden="true">6.4.</strong> Using kubelogin in Jenkins</a></li></ol></li><li class="chapter-item expanded "><a href="../../known-issues.html"><strong aria-hidden="true">7.</strong> Known Issues</a></li><li class="chapter-item expanded "><a href="../../development.html"><strong aria-hidden="true">8.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../development/releasing.html"><strong aria-hidden="true">8.1.</strong> Releasing</a></li></ol></li><li class="chapter-item expanded "><a href="../../contributing.html"><strong aria-hidden="true">9.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="../../code-of-conduct.html"><strong aria-hidden="true">10.</strong> Code of Conduct</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Azure Kubelogin</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Azure/kubelogin" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="azure-pipelines"><a class="header" href="#azure-pipelines">Azure Pipelines</a></h1>
<p>This login mode uses Azure Pipelines service connections and the built-in <code>SYSTEM_ACCESSTOKEN</code> to authenticate with Azure AD. This is particularly useful when running kubelogin as an exec plugin within Azure DevOps pipelines, such as in Terraform deployments that need to interact with Azure Kubernetes Service clusters.</p>
<p>The authentication leverages Azure Pipelines’ managed identity integration through service connections, providing a seamless way to authenticate without additional credential management.</p>
<blockquote>
<h3 id="note"><a class="header" href="#note">NOTE</a></h3>
<p>This login mode only works within Azure DevOps pipelines and requires proper pipeline configuration.</p>
</blockquote>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ol>
<li><strong>Service Connection</strong>: An Azure Resource Manager service connection configured in your Azure DevOps project</li>
<li><strong>Pipeline Configuration</strong>: The pipeline must have “Allow scripts to access the OAuth token” enabled in the agent job settings</li>
<li><strong>Environment Variables</strong>: The following environment variables must be available (automatically set by Azure Pipelines when OAuth token access is enabled):
<ul>
<li><code>SYSTEM_ACCESSTOKEN</code>: The OAuth token provided by Azure Pipelines</li>
<li><code>SYSTEM_OIDCREQUESTURI</code>: The OIDC request URI (automatically set by Azure Pipelines)</li>
</ul>
</li>
</ol>
<h2 id="required-parameters"><a class="header" href="#required-parameters">Required Parameters</a></h2>
<ul>
<li><code>--tenant-id</code>: Azure AD tenant ID where the service connection is configured</li>
<li><code>--client-id</code>: Application ID of the client application (typically the AKS cluster’s client ID)</li>
<li><code>--server-id</code>: Application ID of the server/resource (typically the AKS cluster’s server ID)</li>
<li><code>--azure-pipelines-service-connection-id</code>: The resource ID of the Azure Resource Manager service connection</li>
</ul>
<blockquote>
<p><strong>Note</strong>: When using <code>AzureCLI@2</code> task with Azure Resource Manager service connections, Azure Pipelines automatically sets the following environment variables which kubelogin will use if the corresponding flags are not provided:</p>
<ul>
<li><code>AZURESUBSCRIPTION_TENANT_ID</code> - Automatically used for <code>--tenant-id</code></li>
<li><code>AZURESUBSCRIPTION_CLIENT_ID</code> - Automatically used for <code>--client-id</code></li>
<li><code>AZURESUBSCRIPTION_SERVICE_CONNECTION_ID</code> - Automatically used for <code>--azure-pipelines-service-connection-id</code></li>
</ul>
<p>This means you only need to provide the <code>--server-id</code> parameter when these environment variables are available.</p>
</blockquote>
<h2 id="usage-examples"><a class="header" href="#usage-examples">Usage Examples</a></h2>
<h3 id="basic-usage-in-pipeline"><a class="header" href="#basic-usage-in-pipeline">Basic Usage in Pipeline</a></h3>
<pre><code class="language-yaml"># azure-pipelines.yml
steps:
- task: AzureCLI@2
  displayName: 'Deploy to AKS'
  inputs:
    azureSubscription: 'my-service-connection'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      # Download kubeconfig from AKS
      az aks get-credentials -g ${RESOURCE_GROUP} -n ${AKS_NAME}
      
      # Configure kubeconfig to use azurepipelines login
      # tenant-id, client-id, and service-connection-id are automatically detected from environment variables
      kubelogin convert-kubeconfig --login azurepipelines
      
      # Now kubectl commands will authenticate using Azure Pipelines credentials
      kubectl get nodes
</code></pre>
<h3 id="basic-usage-with-explicit-parameters"><a class="header" href="#basic-usage-with-explicit-parameters">Basic Usage with Explicit Parameters</a></h3>
<p>If you prefer to explicitly provide all parameters:</p>
<pre><code class="language-yaml"># azure-pipelines.yml
steps:
- task: AzureCLI@2
  displayName: 'Deploy to AKS'
  inputs:
    azureSubscription: 'my-service-connection'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      # Configure kubeconfig to use azurepipelines login with explicit parameters
      kubelogin convert-kubeconfig \
        --login azurepipelines \
        --tenant-id $(tenant-id) \
        --client-id $(client-id) \
        --server-id $(server-id) \
        --azure-pipelines-service-connection-id $(service-connection-resource-id)
      
      # Now kubectl commands will authenticate using Azure Pipelines credentials
      kubectl get nodes
</code></pre>
<h3 id="direct-token-retrieval"><a class="header" href="#direct-token-retrieval">Direct Token Retrieval</a></h3>
<pre><code class="language-bash"># In Azure DevOps pipeline (with &quot;Allow scripts to access the OAuth token&quot; enabled)
# Simplified version - uses environment variables automatically set by Azure Pipelines
kubelogin get-token \
  --login azurepipelines \
  --server-id &lt;cluster-server-id&gt;

# Or with explicit parameters
kubelogin get-token \
  --login azurepipelines \
  --tenant-id &lt;tenant-id&gt; \
  --client-id &lt;client-id&gt; \
  --server-id &lt;cluster-server-id&gt; \
  --azure-pipelines-service-connection-id &lt;service-connection-resource-id&gt;
</code></pre>
<h2 id="environment-variable-support"><a class="header" href="#environment-variable-support">Environment Variable Support</a></h2>
<p>When using <code>AzureCLI@2</code> task with Azure Resource Manager service connections, Azure Pipelines automatically sets environment variables for the service connection. Kubelogin automatically detects and uses these variables:</p>
<div class="table-wrapper"><table><thead><tr><th>Environment Variable</th><th>Used For</th><th>Command-line Flag Equivalent</th></tr></thead><tbody>
<tr><td><code>AZURESUBSCRIPTION_TENANT_ID</code></td><td>Tenant ID</td><td><code>--tenant-id</code></td></tr>
<tr><td><code>AZURESUBSCRIPTION_CLIENT_ID</code></td><td>Client ID</td><td><code>--client-id</code></td></tr>
<tr><td><code>AZURESUBSCRIPTION_SERVICE_CONNECTION_ID</code></td><td>Service Connection ID</td><td><code>--azure-pipelines-service-connection-id</code></td></tr>
</tbody></table>
</div>
<p><strong>Precedence</strong>: Command-line flags always take precedence over environment variables. This allows you to override specific values when needed.</p>
<p><strong>Disabling Environment Variables</strong>: You can use the <code>--disable-environment-override</code> flag to ignore all environment variables and require explicit parameters.</p>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<ol>
<li><strong>Service Connection</strong>: Azure DevOps service connections provide managed identity or service principal authentication to Azure resources</li>
<li><strong>System Access Token</strong>: When “Allow scripts to access the OAuth token” is enabled, Azure Pipelines provides a <code>SYSTEM_ACCESSTOKEN</code> environment variable</li>
<li><strong>Environment Variables</strong>: When using <code>AzureCLI@2</code> task with Azure Resource Manager service connections, Azure Pipelines automatically sets subscription-specific environment variables</li>
<li><strong>OIDC Integration</strong>: The <code>azurepipelines</code> login method uses Azure SDK’s <code>AzurePipelinesCredential</code> to exchange the system access token for an Azure AD token</li>
<li><strong>Token Caching</strong>: Authentication tokens are cached to improve performance across multiple kubectl operations</li>
</ol>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="common-errors"><a class="header" href="#common-errors">Common Errors</a></h3>
<ul>
<li><strong>“SYSTEM_ACCESSTOKEN environment variable not set”</strong>: Enable “Allow scripts to access the OAuth token” in your pipeline job settings</li>
<li><strong>“SYSTEM_OIDCREQUESTURI environment variable not set”</strong>: This should be automatically set by Azure Pipelines; check your Azure DevOps version and configuration</li>
<li><strong>“tenant ID is required”</strong>: Provide the <code>--tenant-id</code> parameter</li>
<li><strong>“–azure-pipelines-service-connection-id is required”</strong>: Provide the service connection resource ID parameter</li>
</ul>
<h3 id="finding-service-connection-resource-id"><a class="header" href="#finding-service-connection-resource-id">Finding Service Connection Resource ID</a></h3>
<p>The service connection resource ID can be found in the Azure DevOps portal:</p>
<ol>
<li>Go to Project Settings → Service connections</li>
<li>Select your Azure Resource Manager service connection</li>
<li>The resource ID is displayed in the connection details</li>
</ol>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li>https://learn.microsoft.com/en-us/azure/devops/pipelines/process/system-and-variable-groups</li>
<li>https://learn.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints</li>
<li>https://pkg.go.dev/github.com/Azure/azure-sdk-for-go/sdk/azidentity#AzurePipelinesCredential</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../concepts/login-modes/azd.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../concepts/login-modes/interactive.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../concepts/login-modes/azd.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../concepts/login-modes/interactive.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
